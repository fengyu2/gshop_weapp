"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Api=void 0;var _api=require("../lib/api.js"),_storage=require("../lib/storage.js"),_taro=require("../lib/taro.js"),_constant=require("../config/constant.js"),_apiWeapp=require("../lib/api-weapp.js"),_storeLib=require("../reducers/store-lib.js"),_constant2=require("../config-app/constant.js"),_cache=require("../lib/cache.js"),Api={defaultCallback:_api.Api.defaultCallback,System:_api.Api,init:function(){_api.Api.setDebug(!0),_api.Api.debug("Api.init"),_api.Api.addErrorInterceptor(function(e){return e.code===_constant2.Code.NEED_LOGIN?(_taro.Taro.navigateTo({url:_constant.ApiConstant.LOGIN}),!1):e.code!==_constant2.Code.NEED_STORE||(_taro.Taro.redirectTo({url:"/pages/store_search"}),!1)})},launchInited:!1,launch:function(e,t){if(e&&e.currentStore&&_storage.Storage.setObjectMerge("apiParam",{currentStore:e.currentStore}),Api.launchInited)t&&t();else switch(Api.launchInited=!0,_constant.ApiConstant.ENV){case _taro.Taro.ENV_TYPE.WEAPP:_apiWeapp.ApiWeapp.login(function(e){Api.config(e,function(){Api.memberAuthInfo(function(e){t&&t()})})});break;case _taro.Taro.ENV_TYPE.WEB:Api.config(null,function(){Api.memberAuthInfo(function(e){t&&t()})})}},process:function(e,t,i,a){_api.Api.process(e,t,i,a,{loading:!0})},processCache:function(e,t,i,a,n){_cache.Cache.remember("request:"+t,e,function(e){a(e)},function(e){_api.Api.process(t,i,e,n,{loading:!0})})},config:function(e,t){Api.process("config",{code:e},function(e){_storeLib.store.dispatch({type:"SetConfig",data:e.data}),t&&t()})},configUpdate:function(t){Api.process("config/update",{},function(e){_storeLib.store.dispatch({type:"SetConfig",data:e.data}),t&&t()})},memberAuthInfo:function(t){Api.process("member_auth/info",{},function(e){_storeLib.store.dispatch({type:"SetMemberUser",data:e.data.memberUser}),t&&t(e.data.memberUser)})},memberAuthRetrieveCaptchaUrl:function(){return _constant.ApiConstant.BASE+"member_auth/retrieve_captcha?api_token="+_api.Api.apiToken()+"&"+Math.random()},memberProfileCaptchaUrl:function(){return _constant.ApiConstant.BASE+"member_profile/captcha?api_token="+_api.Api.apiToken()+"&"+Math.random()}};exports.Api=Api;