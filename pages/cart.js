"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _dec,_class,_class2,_temp2,_createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}(),_get=function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,o,r)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(r):void 0},_index=require("../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../npm/@tarojs/redux/index.js"),_api=require("../lib-app/api.js"),_dialog=require("../lib/dialog.js"),_storage=require("../lib/storage.js"),_storeUtil=require("../reducers/store-util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Index=(_dec=(0,_index3.connect)(function(e){return e}))((_temp2=_class2=function(e){function i(){var e,t,o;_classCallCheck(this,i);for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=o=_possibleConstructorReturn(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(n)))).$usedState=["anonymousState__temp3","anonymousState__temp4","anonymousState__temp5","loopArray0","config","records","editing","store"],o.config={navigationBarTitleText:"购物车"},o.state={editing:!1,records:[]},o.$$refs=[],_possibleConstructorReturn(o,t)}return _inherits(i,_index.Component),_createClass(i,[{key:"_constructor",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e)}},{key:"componentWillMount",value:function(){_api.Api.launch(this.$router.params,function(){})}},{key:"calcTotal",value:function(){var t=0;return this.state.records.forEach(function(e){e.checked&&(t+=e.goodsPrice*e.amount)}),t.toFixed(2)}},{key:"calcAllCheck",value:function(){for(var e=0;e<this.state.records.length;e++)if(!this.state.records[e].checked)return!1;return!0}},{key:"doList",value:function(){var o=this;_api.Api.process("cart/list",{},function(e){var t=e.data.records;t.forEach(function(e){e.checked=!0}),o.setState({records:t})})}},{key:"doUncheck",value:function(e){var t=this.state.records;t[e].checked=!1,this.setState({records:t})}},{key:"doCheck",value:function(e){var t=this.state.records;t[e].checked=!0,this.setState({records:t})}},{key:"doDelete",value:function(t){var o=this,r=this.state.records;_api.Api.process("cart/delete",{cartId:this.state.records[t].id},function(e){r.splice(t,1),r.length<=0?o.setState({editing:!1,records:r}):o.setState({editing:!0,records:r}),_api.Api.configUpdate()})}},{key:"doChangeAmount",value:function(e,t){var o=this.state.records;o[e].amount=t,this.setState({records:o})}},{key:"doCheckAll",value:function(){var e=this.state.records;e.map(function(e){return e.checked=!0}),this.setState({records:e})}},{key:"doUncheckAll",value:function(){var e=this.state.records;e.map(function(e){return e.checked=!1}),this.setState({records:e})}},{key:"doSubmit",value:function(){var t=[];this.state.records.map(function(e){e.checked&&t.push({amount:e.amount,cartId:e.id})}),t.length<=0?_dialog.Dialog.tipError("请选择商品"):(_storage.Storage.setObject("cartSubmitData",t),_index2.default.navigateTo({url:"/pages/cart_submit"}))}},{key:"_createData",value:function(){var e=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var t=this.config;this.anonymousFunc0=function(){return e.setState({editing:!0})},this.anonymousFunc1=function(){return e.setState({editing:!1})};var o=this.calcTotal(),r=this.calcAllCheck(),n=!this.calcAllCheck(),a=this.__state.records.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp2:(0,_index.internal_inline_style)({backgroundImage:"url("+e.$original.goodsCover+")"}),$original:e.$original}});return Object.assign(this.__state,{anonymousState__temp3:o,anonymousState__temp4:r,anonymousState__temp5:n,loopArray0:a,config:t}),this.__state}},{key:"componentDidShow",value:function(){this.doList(),(0,_storeUtil.storeConfigSetCartBadge)(this.props.store.config)}},{key:"anonymousFunc0",value:function(e){}},{key:"anonymousFunc1",value:function(e){}}]),i}(),_class2.properties={store:{type:null,value:null}},_class2.$$events=["anonymousFunc0","anonymousFunc1","doUncheck","doCheck","doDelete","doChangeAmount","doSubmit","doUncheckAll","doCheckAll"],_class=_temp2))||_class;exports.default=Index,Component(require("../npm/@tarojs/taro-weapp/index.js").default.createComponent(Index,!0));